<div class="container section" style="display:grid; grid-template-columns: 280px 1fr; gap: 1.25rem; padding: 0px">
    <aside>
        <div class="card card-pad">
            <div class="h5 fw-bold mb-2">B·ªô l·ªçc</div>
            <div class="mb-2"><a href="/products" class="btn btn-outline" style="width:100%">T·∫•t c·∫£ s·∫£n ph·∫©m</a></div>

            <div class="form-group">
                <div class="h6">S·∫Øp x·∫øp</div>
                <div class="stack-sm" style="flex-direction:column; gap:.5rem;">
                    <label class="stack-sm" style="align-items:center; gap:.5rem;">
                        <input role="button" type="radio" name="sort" class="filter-sort" value="sort=low-high" />
                        <span>Gi√°: Th·∫•p ‚Üí Cao</span>
                    </label>
                    <label class="stack-sm" style="align-items:center; gap:.5rem;">
                        <input role="button" type="radio" name="sort" class="filter-sort" value="sort=high-low" />
                        <span>Gi√°: Cao ‚Üí Th·∫•p</span>
                    </label>
                    <label class="stack-sm" style="align-items:center; gap:.5rem;">
                        <input role="button" type="radio" name="sort" class="filter-sort" value="sort=new-first" />
                        <span>M·ªõi nh·∫•t</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <div class="h6">Danh m·ª•c</div>
                <div class="stack-sm" style="flex-direction:column;">
                    {{#each categories}}
                    <label class="stack-sm" style="align-items:center;">
                        <input role="button" class="filter-button" type="checkbox" value="category={{this.cat_name}}" id="category={{this.cat_name}}" />
                        <span>{{this.cat_name}}</span>
                    </label>
                    {{/each}}
                </div>
            </div>

            <div class="form-group">
                <div class="h6">Th∆∞∆°ng hi·ªáu</div>
                <div class="stack-sm" style="flex-direction:column;">
                    {{#each Brands}}
                    <label class="stack-sm" style="align-items:center;">
                        <input role="button" class="filter-brand" type="checkbox" value="brand={{this}}" id="brand={{this}}" />
                        <span>{{this}}</span>
                    </label>
                    {{/each}}
                </div>
            </div>

            <div class="form-group">
                <div class="h6">M√†u s·∫Øc</div>
                <div class="stack-sm" style="flex-direction:column;">
                    {{#each Colors}}
                    <label class="stack-sm" style="align-items:center;">
                        <input role="button" class="filter-color" type="checkbox" value="color={{this}}" id="color={{this}}" />
                        <span style="text-transform:capitalize;">{{this}}</span>
                    </label>
                    {{/each}}
                </div>
            </div>
        </div>
    </aside>

    <main>
        <div class="card card-pad" style="margin-bottom:1rem; display:flex; align-items:center; gap:.75rem;">
            <div class="searchbar" style="flex:1; display:flex; align-items:center; gap:.5rem; padding:.5rem .75rem; border:1px solid #e0e0e0; border-radius:.5rem;">
                <span class="material-icon" aria-hidden="true" style="opacity:.7;">üîé</span>
                <input id="smart-search-input" type="text" placeholder="T√¨m ƒë·ªìng h·ªì theo t√™n, th∆∞∆°ng hi·ªáu, m√†u s·∫Øc‚Ä¶" style="flex:1; border:none; outline:none; font-size:14px;" />
                <button id="smart-search-clear" class="btn btn-outline" style="padding:.25rem .5rem;">X√≥a</button>
                <button id="smart-search-submit" class="btn btn-primary" style="padding:.25rem .75rem;">T√¨m ki·∫øm</button>
            </div>
        </div>

        {{!-- <div id="search-suggestions" class="card" style="display:none; margin-bottom:1rem; border-radius:.5rem; overflow:hidden;">
            <div class="card-pad" style="display:flex; flex-wrap:wrap; gap:.5rem;">
                <!-- G·ª£i √Ω s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS (th∆∞∆°ng hi·ªáu/m√†u ph·ªï bi·∫øn) -->
            </div>
        </div> --}}

        <div class="product-grid">
            {{#each Products}}
            <div class="product-card" data-id="{{this._id}}" data-name="{{this.product_name}}" data-brand="{{this.brand_name}}" data-color="{{this.color}}" data-price="{{this.selling_price}}" data-category="{{this.category_id}}" style="border:1px solid #eee; border-radius:.75rem; overflow:hidden; background:#fff; display:flex; flex-direction:column;">
                <a href="/view_product/{{this._id}}" class="product-media" style="position:relative; display:block; aspect-ratio:1/1; overflow:hidden;">
                    <img src="/productImages/{{this.primary_image.name}}" alt="{{this.product_name}}" style="width:100%; height:100%; object-fit:cover; transition:transform .25s ease;" />
                    <span class="badge" style="position:absolute; top:.5rem; left:.5rem; background:#111; color:#fff; padding:.25rem .5rem; border-radius:.25rem; font-size:12px;">{{this.brand_name}}</span>
                    <span class="badge price-badge" style="position:absolute; top:.5rem; right:.5rem; background:#f5f5f5; color:#333; padding:.25rem .5rem; border-radius:.25rem; font-size:12px;">{{this.selling_price}}‚Ç´</span>
                </a>
                <div class="product-body" style="padding:.75rem; display:flex; flex-direction:column; gap:.5rem;">
                    <div class="product-title" style="font-weight:600; line-height:1.3;">{{this.product_name}}</div>
                    <div class="stack-sm" style="justify-content:space-between; align-items:center;">
                        <span class="muted" style="font-size:12px; text-transform:capitalize;">{{this.color}}</span>
                        {{!-- <span class="rating" style="font-size:12px;">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚òÜ</span> --}}
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
    </main>
</div>

<script>
    (function(){
        const input = document.getElementById('smart-search-input');
        const btnClear = document.getElementById('smart-search-clear');
        const btnSubmit = document.getElementById('smart-search-submit');
        const suggestionBox = document.getElementById('search-suggestions');

        function getSelectedParams(){
            const params = new URLSearchParams();
            // search keyword
            const q = (input.value || '').trim();
            if (q) params.set('q', q);

            // categories
            document.querySelectorAll('.filter-button:checked').forEach(cb => {
                const [key, val] = cb.value.split('=');
                params.append(key, val);
            });
            // brands
            document.querySelectorAll('.filter-brand:checked').forEach(cb => {
                const [key, val] = cb.value.split('=');
                params.append(key, val);
            });
            // colors
            document.querySelectorAll('.filter-color:checked').forEach(cb => {
                const [key, val] = cb.value.split('=');
                params.append(key, val);
            });
            // sort (single)
            const sortEl = document.querySelector('.filter-sort:checked');
            if (sortEl) {
                const [key, val] = sortEl.value.split('=');
                params.set(key, val);
            }
            return params;
        }

        function go(){
            const params = getSelectedParams();
            window.location.href = '/products' + (params.toString() ? ('?' + params.toString()) : '');
        }

        // Submit on button
        btnSubmit?.addEventListener('click', go);
        // Enter to search
        input?.addEventListener('keydown', (e)=>{
            if (e.key === 'Enter') {
                e.preventDefault();
                go();
            }
        });
        // Clear input
        btnClear?.addEventListener('click', ()=>{
            input.value = '';
            input.focus();
        });
        // Change filters triggers navigation
        document.querySelectorAll('.filter-button, .filter-brand, .filter-color, .filter-sort').forEach(el=>{
            el.addEventListener('change', go);
        });

        // Simple local suggestions from server-rendered lists (Brands, Colors)
        try {
            const brands = Array.from(document.querySelectorAll('input[id^="brand="]')).map(i=>i.id.split('=')[1]);
            const colors = Array.from(document.querySelectorAll('input[id^="color="]')).map(i=>i.id.split('=')[1]);
            const cats = Array.from(document.querySelectorAll('input[id^="category="]')).map(i=>i.id.split('=')[1]);
            const suggestions = [...brands.slice(0,4), ...colors.slice(0,4), ...cats.slice(0,4)];
            const pad = suggestionBox?.querySelector('.card-pad');
            if (pad && suggestions.length) {
                suggestionBox.style.display = 'block';
                suggestions.forEach(s => {
                    const chip = document.createElement('button');
                    chip.className = 'btn btn-outline';
                    chip.style.padding = '.25rem .5rem';
                    chip.textContent = s;
                    chip.addEventListener('click', ()=>{
                        input.value = s;
                        go();
                    });
                    pad.appendChild(chip);
                });
            }
        } catch (_) {}
    })();
</script>
